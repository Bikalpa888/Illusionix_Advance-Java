<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Dashboard - Illusionix</title>
    <meta name="description" content="Admin dashboard for Illusionix: manage analytics, orders, products, users, and settings." />
    <link rel="stylesheet" th:href="@{/main.css}" />

    <script type="module" src="https://static.rocket.new/rocket-web.js?_cfg=https%3A%2F%2Fvrcommerc3603back.builtwithrocket.new&_be=https%3A%2F%2Fapplication.rocket.new&_v=0.1.8"></script>
</head>
<body class="bg-background text-text-primary">
<!-- Top Navigation -->
<header class="bg-surface/80 backdrop-blur-md border-b border-primary-200 sticky top-0 z-50">
    <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center h-16">
            <!-- Logo -->
            <div class="flex items-center">
                <svg class="w-10 h-10 text-secondary" viewBox="0 0 40 40" fill="currentColor">
                    <path d="M20 4L36 12v16L20 36L4 28V12L20 4z"/>
                    <circle cx="20" cy="20" r="8" fill="white"/>
                    <circle cx="20" cy="20" r="4" fill="currentColor"/>
                </svg>
                <span class="ml-3 text-xl font-bold text-primary">Illusionix</span>
            </div>

            <!-- Desktop Navigation -->
            <div class="hidden md:flex items-center space-x-8">
                <a href="homepage" class="text-text-secondary hover:text-secondary transition-colors">Home</a>
                <a href="product_categories" class="text-text-secondary hover:text-secondary transition-colors">Products</a>
                <a href="virtual_showroom" class="text-text-secondary hover:text-secondary transition-colors">Virtual Showroom</a>
                <a href="user_dashboard" class="text-text-secondary hover:text-secondary transition-colors">Dashboard</a>
                <a href="admin_dashboard" class="text-secondary font-semibold">Admin</a>
                <a href="aboutus" class="text-text-secondary hover:text-secondary transition-colors">About</a>
                <a href="contact" class="text-text-secondary hover:text-secondary transition-colors">Contact</a>

                <!-- Search Bar -->
                <div class="relative">
                    <button id="search-toggle" class="text-text-secondary hover:text-secondary transition-colors p-2">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                        </svg>
                    </button>
                    <div id="search-expanded" class="absolute right-0 top-full mt-2 transform scale-0 transition-transform duration-300 origin-top-right">
                        <div class="relative">
                            <input type="text" id="search-input" placeholder="Search products..." class="input-field pl-10 pr-4 py-2 w-64 bg-white shadow-lg border border-primary-200" />
                            <svg class="w-5 h-5 text-text-secondary absolute left-3 top-1/2 transform -translate-y-1/2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                            </svg>

                            <!-- Search Results Dropdown -->
                            <div id="search-results" class="absolute top-full left-0 right-0 bg-white shadow-lg rounded-lg mt-2 border border-primary-200 hidden max-h-64 overflow-y-auto">
                                <!-- Search results will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flex items-center space-x-4">
                    <a href="shopping_cart_checkout" class="relative text-text-secondary hover:text-secondary">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-2.5 5M7 13l2.5 5m6-5v6a2 2 0 01-2 2H9a2 2 0 01-2-2v-6m8 0V9a2 2 0 00-2-2H9a2 2 0 00-2 2v4.01"/>
                        </svg>
                        <span id="cart-count" class="absolute -top-2 -right-2 bg-accent text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">0</span>
                    </a>
                    <button class="theme-toggle text-text-secondary hover:text-secondary" aria-pressed="false" title="Switch theme">
                        <svg data-icon="moon" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 118.646 3.646 7 7 0 0020.354 15.354z"/></svg>
                        <svg data-icon="sun" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v2m0 14v2m9-9h-2M5 12H3m15.364 6.364l-1.414-1.414M7.05 7.05 5.636 5.636m12.728 0-1.414 1.414M7.05 16.95l-1.414 1.414M12 8a4 4 0 100 8 4 4 0 000-8z"/></svg>
                    </button>
                    <a href="#" class="btn-secondary" data-action="logout">Logout</a>
                </div>
            </div>

            <!-- Mobile Menu Button -->
            <button class="md:hidden text-text-secondary">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                </svg>
            </button>
        </div>
    </nav>
</header>

<!-- Header Banner -->
<section class="bg-gradient-to-br from-primary-900 via-primary-800 to-secondary-900 text-white py-12">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center">
            <div>
                <h1 class="text-4xl font-bold mb-2">Admin Control Center</h1>
                <p class="text-primary-200 text-lg">Monitor, manage, and optimize your VR commerce</p>
            </div>
            <div class="mt-6 md:mt-0 flex items-center space-x-4">
                <div class="bg-white/10 backdrop-blur-md rounded-lg px-4 py-2 border border-white/20">
                    <div class="flex items-center">
                        <svg class="w-5 h-5 text-accent mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        <span class="text-sm">Role: Super Admin</span>
                    </div>
                </div>
                <a href="#settings" class="btn-accent text-sm">Go to Settings</a>
            </div>
        </div>
    </div>
</section>
<script>
    (function(){
      const KEY='illusionix_cart';
      function read(){try{return JSON.parse(localStorage.getItem(KEY)||'{"items":[]}');}catch(_){return {items:[]};}}
      function write(c){try{localStorage.setItem(KEY, JSON.stringify(c));}catch(_){}}
      function total(){return read().items.reduce((s,it)=>s+(it.qty||0),0);}
      function updateBadges(){document.querySelectorAll('#cart-count,[data-cart-count]').forEach(el=>el.textContent=String(total()));}
      if(!('Cart' in window)){
        window.Cart={
          add({id,name,price,image,qty=1}){const c=read();const k=String(id);const ex=c.items.find(it=>String(it.id)===k);if(ex){ex.qty+=qty;}else{c.items.push({id:k,name,price:Number(price||0),image:image||'',qty});}write(c);updateBadges();return c;},
          get(){return read();},clear(){write({items:[]});updateBadges();}
        };
      }
      document.addEventListener('click',function(e){const btn=e.target.closest('[data-add-to-cart]');if(!btn)return;Cart.add({id:btn.getAttribute('data-id'),name:btn.getAttribute('data-name'),price:Number(btn.getAttribute('data-price')||0),image:btn.getAttribute('data-image')||'',qty:1});btn.classList.add('ring-2','ring-accent');setTimeout(()=>btn.classList.remove('ring-2','ring-accent'),400);});
      if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',updateBadges);}else{updateBadges();}
    })();
</script>
<script>
    // Inline theme/ui fallbacks (auth removed)
    (function(){
      if(!window.__themeInlineLoaded){window.__themeInlineLoaded=true;const K='illusionix-theme',D='theme-dark';function a(t){const r=document.documentElement; t==='dark'?r.classList.add(D):r.classList.remove(D)}function g(){try{return localStorage.getItem(K)}catch(_){return null}}function s(t){try{localStorage.setItem(K,t)}catch(_){}}const i=g()||'light';a(i);function c(){return document.documentElement.classList.contains(D)?'dark':'light'}function u(t){document.querySelectorAll('.theme-toggle [data-icon="sun"]').forEach(e=>e.style.display=t==='dark'?'inline-block':'none');document.querySelectorAll('.theme-toggle [data-icon="moon"]').forEach(e=>e.style.display=t==='dark'?'none':'inline-block');document.querySelectorAll('.theme-toggle').forEach(b=>{b.setAttribute('aria-pressed',t==='dark'?'true':'false');b.setAttribute('title',t==='dark'?'Switch to light mode':'Switch to dark mode')})}function t(){const n=c()==='dark'?'light':'dark';a(n);s(n);u(n)}function b(){document.querySelectorAll('.theme-toggle').forEach(x=>x.addEventListener('click',t));u(c())}if(document.readyState==='loading')document.addEventListener('DOMContentLoaded',b);else b();}
      if(!window.__uiInlineLoaded){window.__uiInlineLoaded=true;function SF(e){e.preventDefault();const f=document.querySelector('footer');if(f)f.scrollIntoView({behavior:'smooth',block:'start'});else window.scrollTo({top:document.body.scrollHeight,behavior:'smooth'})}document.querySelectorAll('a[href="#site-footer"]').forEach(a=>a.addEventListener('click',SF));if(!document.getElementById('btn-ripple-style')){const s=document.createElement('style');s.id='btn-ripple-style';s.textContent='.btn-ripple{position:relative;overflow:hidden}.btn-ripple .ripple{position:absolute;border-radius:50%;transform:scale(0);animation:ripple 600ms linear;background:currentColor;opacity:.2}@keyframes ripple{to{transform:scale(4);opacity:0}}';document.head.appendChild(s)}document.querySelectorAll('.btn-accent,.btn-secondary,button,a.btn').forEach(b=>{b.classList.add('btn-ripple');b.addEventListener('click',function(e){const r=this.getBoundingClientRect();const el=document.createElement('span');const size=Math.max(r.width,r.height);el.className='ripple';el.style.width=el.style.height=size+'px';el.style.left=(e.clientX-r.left-size/2)+'px';el.style.top=(e.clientY-r.top-size/2)+'px';this.appendChild(el);setTimeout(()=>el.remove(),650)})})}
    })();
</script>

<!-- Dashboard Content -->
<section class="py-12 bg-background">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="grid lg:grid-cols-4 gap-8">
            <!-- Sidebar -->
            <aside class="lg:col-span-1">
                <div class="card sticky top-24">
                    <nav class="space-y-2">
                        <a href="#overview" class="flex items-center px-4 py-3 text-secondary bg-secondary-50 rounded-lg font-semibold">
                            <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V9a2 2 0 012-2h2a2 2 0 012 2v10M5 19h14"/>
                            </svg>
                            Overview
                        </a>
                        <a href="#analytics" class="flex items-center px-4 py-3 text-text-secondary hover:text-secondary hover:bg-primary-50 rounded-lg transition-colors">
                            <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 3v18M3 13l4 4L21 3"/>
                            </svg>
                            Analytics
                        </a>
                        <a href="#orders" class="flex items-center px-4 py-3 text-text-secondary hover:text-secondary hover:bg-primary-50 rounded-lg transition-colors">
                            <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7h18M5 11h14M7 15h10M9 19h6"/>
                            </svg>
                            Orders
                        </a>
                        <a href="#products" class="flex items-center px-4 py-3 text-text-secondary hover:text-secondary hover:bg-primary-50 rounded-lg transition-colors">
                            <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V7a2 2 0 00-2-2h-4M4 7v10a2 2 0 002 2h12"/>
                            </svg>
                            Products
                        </a>
                        <a href="#users" class="flex items-center px-4 py-3 text-text-secondary hover:text-secondary hover:bg-primary-50 rounded-lg transition-colors">
                            <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M9 7a4 4 0 110 8 4 4 0 010-8z"/>
                            </svg>
                            Users
                        </a>
                        <a href="#content" class="flex items-center px-4 py-3 text-text-secondary hover:text-secondary hover:bg-primary-50 rounded-lg transition-colors">
                            <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16h8M8 12h8m-7 8h6M5 8h14l1 12H4L5 8zM9 8V6a3 3 0 116 0v2"/>
                            </svg>
                            Content
                        </a>
                        <a href="#settings" class="flex items-center px-4 py-3 text-text-secondary hover:text-secondary hover:bg-primary-50 rounded-lg transition-colors">
                            <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 11V7m0 0a4 4 0 118 0v4m-8 0H7m0 0a4 4 0 100 8h4m0-8v4m0 0a4 4 0 108 0v-4"/>
                            </svg>
                            Settings
                        </a>
                    </nav>
                </div>
            </aside>

            <!-- Main -->
            <main class="lg:col-span-3 space-y-8">
                <!-- Overview -->
                <section id="overview">
                    <div class="grid md:grid-cols-4 gap-6 mb-8">
                        <div class="card text-center">
                            <div class="w-12 h-12 bg-secondary-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <svg class="w-6 h-6 text-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 3v18M3 13l4 4L21 3"/>
                                </svg>
                            </div>
                            <div class="text-2xl font-bold text-primary mb-1">$84,320</div>
                            <div class="text-sm text-text-secondary">Monthly Revenue</div>
                        </div>
                        <div class="card text-center">
                            <div class="w-12 h-12 bg-accent-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <svg class="w-6 h-6 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7h18M5 11h14M7 15h10"/>
                                </svg>
                            </div>
                            <div class="text-2xl font-bold text-primary mb-1">1,248</div>
                            <div class="text-sm text-text-secondary">Orders</div>
                        </div>
                        <div class="card text-center">
                            <div class="w-12 h-12 bg-success-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <svg class="w-6 h-6 text-success" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2a4 4 0 118 0v2"/>
                                </svg>
                            </div>
                            <div class="text-2xl font-bold text-primary mb-1">8,534</div>
                            <div class="text-sm text-text-secondary">Active Users</div>
                        </div>
                        <div class="card text-center">
                            <div class="w-12 h-12 bg-warning-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <svg class="w-6 h-6 text-warning" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3"/>
                                </svg>
                            </div>
                            <div class="text-2xl font-bold text-primary mb-1">312 ms</div>
                            <div class="text-sm text-text-secondary">Avg. Response</div>
                        </div>
                    </div>

                    <div class="grid md:grid-cols-3 gap-6">
                        <div class="card md:col-span-2">
                            <div class="flex justify-between items-center mb-4">
                                <h2 class="text-2xl font-bold text-primary">Sales Performance</h2>
                                <span class="text-sm text-text-secondary">Last 30 days</span>
                            </div>
                            <!-- Simple bars as placeholder chart -->
                            <div class="grid grid-cols-12 items-end gap-2 h-40">
                                <div class="bg-accent/30 rounded-t w-full" style="height: 30%"></div>
                                <div class="bg-accent/30 rounded-t w-full" style="height: 50%"></div>
                                <div class="bg-accent/30 rounded-t w-full" style="height: 45%"></div>
                                <div class="bg-accent rounded-t w-full" style="height: 80%"></div>
                                <div class="bg-accent/30 rounded-t w-full" style="height: 55%"></div>
                                <div class="bg-accent/30 rounded-t w-full" style="height: 35%"></div>
                                <div class="bg-accent rounded-t w-full" style="height: 85%"></div>
                                <div class="bg-accent/30 rounded-t w-full" style="height: 60%"></div>
                                <div class="bg-accent/30 rounded-t w-full" style="height: 40%"></div>
                                <div class="bg-accent/30 rounded-t w-full" style="height: 50%"></div>
                                <div class="bg-accent/30 rounded-t w-full" style="height: 45%"></div>
                                <div class="bg-accent rounded-t w-full" style="height: 90%"></div>
                            </div>
                        </div>
                        <div class="card">
                            <h2 class="text-2xl font-bold text-primary mb-4">System Health</h2>
                            <div class="space-y-4">
                                <div class="flex items-center justify-between">
                                    <span class="text-sm text-text-secondary">API Uptime</span>
                                    <span class="font-semibold text-success">99.98%</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-sm text-text-secondary">Error Rate</span>
                                    <span class="font-semibold text-warning">0.12%</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-sm text-text-secondary">Queue Depth</span>
                                    <span class="font-semibold text-primary">14</span>
                                </div>
                                <button class="btn-secondary w-full mt-2">View Logs</button>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Analytics -->
                <section id="analytics" class="card">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-primary">Traffic & Conversion</h2>
                        <div class="flex gap-2">
                            <button class="btn-secondary text-sm">Export</button>
                            <button class="btn-accent text-sm">Download CSV</button>
                        </div>
                    </div>
                    <div class="grid md:grid-cols-3 gap-6">
                        <div class="p-4 border border-primary-200 rounded-lg">
                            <p class="text-sm text-text-secondary mb-2">Unique Visitors</p>
                            <p class="text-3xl font-bold text-primary">54,210</p>
                            <p class="text-sm text-success mt-1">+12.4% WoW</p>
                        </div>
                        <div class="p-4 border border-primary-200 rounded-lg">
                            <p class="text-sm text-text-secondary mb-2">Conversion Rate</p>
                            <p class="text-3xl font-bold text-primary">3.98%</p>
                            <p class="text-sm text-success mt-1">+0.3% WoW</p>
                        </div>
                        <div class="p-4 border border-primary-200 rounded-lg">
                            <p class="text-sm text-text-secondary mb-2">AOV</p>
                            <p class="text-3xl font-bold text-primary">$142.67</p>
                            <p class="text-sm text-warning mt-1">-1.1% WoW</p>
                        </div>
                    </div>
                </section>

                <!-- Orders -->
                <section id="orders" class="card">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-primary">Recent Orders</h2>
                        <button class="btn-accent text-sm">View All</button>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full text-sm">
                            <thead>
                            <tr class="text-left text-text-secondary border-b border-primary-200">
                                <th class="py-3 pr-4">Order ID</th>
                                <th class="py-3 pr-4">Customer</th>
                                <th class="py-3 pr-4">Items</th>
                                <th class="py-3 pr-4">Total</th>
                                <th class="py-3 pr-4">Status</th>
                                <th class="py-3">Actions</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr class="border-b border-primary-100">
                                <td class="py-4 pr-4 font-semibold text-primary">VR-2025-1023</td>
                                <td class="py-4 pr-4">Alex Doe</td>
                                <td class="py-4 pr-4">Meta Quest 3</td>
                                <td class="py-4 pr-4 font-semibold">$549</td>
                                <td class="py-4 pr-4"><span class="px-2 py-1 rounded-full text-xs bg-success-100 text-success">Paid</span></td>
                                <td class="py-4"><button class="btn-secondary text-xs px-3 py-2">Manage</button></td>
                            </tr>
                            <tr class="border-b border-primary-100">
                                <td class="py-4 pr-4 font-semibold text-primary">VR-2025-1022</td>
                                <td class="py-4 pr-4">Jamie Lin</td>
                                <td class="py-4 pr-4">VR Controller Pro</td>
                                <td class="py-4 pr-4 font-semibold">$149</td>
                                <td class="py-4 pr-4"><span class="px-2 py-1 rounded-full text-xs bg-warning-50 text-warning">Pending</span></td>
                                <td class="py-4"><button class="btn-secondary text-xs px-3 py-2">Manage</button></td>
                            </tr>
                            <tr>
                                <td class="py-4 pr-4 font-semibold text-primary">VR-2025-1021</td>
                                <td class="py-4 pr-4">Priya N.</td>
                                <td class="py-4 pr-4">ISS Experience</td>
                                <td class="py-4 pr-4 font-semibold">$49</td>
                                <td class="py-4 pr-4"><span class="px-2 py-1 rounded-full text-xs bg-error-100 text-error">Failed</span></td>
                                <td class="py-4"><button class="btn-secondary text-xs px-3 py-2">Retry</button></td>
                            </tr>
                            </tbody>
                            <!-- DB-backed products -->
                            <tbody th:if="${products} != null">
                            <tr th:each="p : ${products}" class="border-b border-primary-100">
                                <td class="py-4 pr-4 font-semibold" th:text="${p.sku}">SKU</td>
                                <td class="py-4 pr-4"><span th:text="${p.name}">Name</span></td>
                                <td class="py-4 pr-4" th:text="${p.price}">$0.00</td>
                                <td class="py-4 pr-4" th:text="${p.inventory}">0</td>
                                <td class="py-4 pr-4"><span class="px-2 py-1 rounded-full text-xs bg-primary-100 text-primary" th:text="${p.status}">Status</span></td>
                                <td class="py-4"><div class="flex gap-2"><!-- actions --></div></td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Products -->
                <section id="products" class="card">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-primary">Products</h2>
                        <div class="flex gap-2">
                            <button id="new-product-btn" class="btn-secondary text-sm" onclick="var m=document.getElementById('add-product-modal');m.classList.remove('hidden');m.classList.add('flex');">New Product</button>
                            <button id="bulk-upload-btn" class="btn-accent text-sm">Bulk Upload</button>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full text-sm">
                            <thead>
                            <tr class="text-left text-text-secondary border-b border-primary-200">
                                <th class="py-3 pr-4">SKU</th>
                                <th class="py-3 pr-4">Name</th>
                                <th class="py-3 pr-4">Price</th>
                                <th class="py-3 pr-4">Inventory</th>
                                <th class="py-3 pr-4">Status</th>
                                <th class="py-3">Actions</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr class="border-b border-primary-100">
                                <td class="py-4 pr-4 font-semibold">MQ3-128</td>
                                <td class="py-4 pr-4">Meta Quest 3 - 128GB</td>
                                <td class="py-4 pr-4">$549</td>
                                <td class="py-4 pr-4">42</td>
                                <td class="py-4 pr-4"><span class="px-2 py-1 rounded-full text-xs bg-success-100 text-success">Active</span></td>
                                <td class="py-4"><div class="flex gap-2"><button class="btn-secondary text-xs px-3 py-2">Edit</button><button class="btn-accent text-xs px-3 py-2">Feature</button></div></td>
                            </tr>
                            <tr class="border-b border-primary-100">
                                <td class="py-4 pr-4 font-semibold">VRC-SET</td>
                                <td class="py-4 pr-4">VR Controller Pro</td>
                                <td class="py-4 pr-4">$149</td>
                                <td class="py-4 pr-4">120</td>
                                <td class="py-4 pr-4"><span class="px-2 py-1 rounded-full text-xs bg-warning-50 text-warning">Low Stock</span></td>
                                <td class="py-4"><div class="flex gap-2"><button class="btn-secondary text-xs px-3 py-2">Edit</button><button class="btn-accent text-xs px-3 py-2">Restock</button></div></td>
                            </tr>
                            <tr>
                                <td class="py-4 pr-4 font-semibold">EX-ISS</td>
                                <td class="py-4 pr-4">ISS VR Experience</td>
                                <td class="py-4 pr-4">$49</td>
                                <td class="py-4 pr-4">∞</td>
                                <td class="py-4 pr-4"><span class="px-2 py-1 rounded-full text-xs bg-success-100 text-success">Active</span></td>
                                <td class="py-4"><div class="flex gap-2"><button class="btn-secondary text-xs px-3 py-2">Edit</button><button class="btn-accent text-xs px-3 py-2">Promote</button></div></td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Add Product Modal -->
                <div id="add-product-modal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
                    <div class="bg-white rounded-xl shadow-xl w-full max-w-2xl mx-4">
                        <div class="flex items-center justify-between px-6 py-4 border-b border-primary-200">
                            <h3 class="text-xl font-semibold text-primary">Add New Product</h3>
                            <button type="button" id="close-add-product" class="text-text-secondary hover:text-error" aria-label="Close" onclick="var m=document.getElementById('add-product-modal');m.classList.add('hidden');m.classList.remove('flex');">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
                            </button>
                        </div>
                        <form id="add-product-form" class="px-6 py-5 space-y-5" autocomplete="off" method="post" action="/admin/products" enctype="multipart/form-data">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-text-secondary mb-1" for="ap-sku">SKU</label>
                                    <input id="ap-sku" name="sku" type="text" required class="input-field w-full" placeholder="e.g. MQ3-128" />
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-text-secondary mb-1" for="ap-name">Name</label>
                                    <input id="ap-name" name="name" type="text" required class="input-field w-full" placeholder="Product name" />
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-text-secondary mb-1" for="ap-price">Price (USD)</label>
                                    <input id="ap-price" name="price" type="number" step="0.01" min="0" required class="input-field w-full" placeholder="0.00" />
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-text-secondary mb-1" for="ap-inventory">Inventory</label>
                                    <input id="ap-inventory" name="inventory" type="number" step="1" min="0" required class="input-field w-full" placeholder="0" />
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-text-secondary mb-1" for="ap-status">Status</label>
                                    <select id="ap-status" name="status" class="input-field w-full">
                                        <option value="Active" selected>Active</option>
                                        <option value="Draft">Draft</option>
                                        <option value="Low Stock">Low Stock</option>
                                    </select>
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-text-secondary mb-1" for="ap-description">Description</label>
                                <textarea id="ap-description" name="description" rows="4" class="input-field w-full" placeholder="Describe the product features, materials, compatibility, etc."></textarea>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-text-secondary mb-2" for="ap-images">Images</label>
                                <input id="ap-images" name="images" type="file" accept="image/*" multiple class="block w-full text-sm text-text-secondary file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-secondary file:text-white hover:file:bg-blue-700" />
                                <p class="text-xs text-text-secondary mt-1">You can upload up to 6 images. First image is used as thumbnail.</p>
                                <div id="ap-image-previews" class="mt-3 grid grid-cols-3 sm:grid-cols-6 gap-2"></div>
                            </div>

                            <div class="flex items-center justify-end gap-3 pt-2 border-t border-primary-200">
                                <button type="button" id="cancel-add-product" class="btn-secondary bg-primary-100 text-primary hover:bg-primary-200" onclick="var m=document.getElementById('add-product-modal');m.classList.add('hidden');m.classList.remove('flex');">Cancel</button>
                                <button type="submit" class="btn-accent">Save Product</button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Users -->
                <section id="users" class="card">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-primary">Users</h2>
                        <div class="flex gap-2">
                            <button class="btn-secondary text-sm">Invite User</button>
                            <button class="btn-accent text-sm">Export</button>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full text-sm">
                            <thead>
                            <tr class="text-left text-text-secondary border-b border-primary-200">
                                <th class="py-3 pr-4">User</th>
                                <th class="py-3 pr-4">Email</th>
                                <th class="py-3 pr-4">Role</th>
                                <th class="py-3 pr-4">Status</th>
                                <th class="py-3">Actions</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr class="border-b border-primary-100">
                                <td class="py-4 pr-4 font-semibold">Alex Doe</td>
                                <td class="py-4 pr-4">alex@example.com</td>
                                <td class="py-4 pr-4">Admin</td>
                                <td class="py-4 pr-4"><span class="px-2 py-1 rounded-full text-xs bg-success-100 text-success">Active</span></td>
                                <td class="py-4"><div class="flex gap-2"><button class="btn-secondary text-xs px-3 py-2">Edit</button><button class="btn-accent text-xs px-3 py-2">Reset</button></div></td>
                            </tr>
                            <tr class="border-b border-primary-100">
                                <td class="py-4 pr-4 font-semibold">Jamie Lin</td>
                                <td class="py-4 pr-4">jamie@example.com</td>
                                <td class="py-4 pr-4">Manager</td>
                                <td class="py-4 pr-4"><span class="px-2 py-1 rounded-full text-xs bg-warning-50 text-warning">Pending</span></td>
                                <td class="py-4"><div class="flex gap-2"><button class="btn-secondary text-xs px-3 py-2">Approve</button><button class="btn-accent text-xs px-3 py-2">Resend</button></div></td>
                            </tr>
                            <tr>
                                <td class="py-4 pr-4 font-semibold">Priya N.</td>
                                <td class="py-4 pr-4">priya@example.com</td>
                                <td class="py-4 pr-4">Support</td>
                                <td class="py-4 pr-4"><span class="px-2 py-1 rounded-full text-xs bg-error-100 text-error">Suspended</span></td>
                                <td class="py-4"><div class="flex gap-2"><button class="btn-secondary text-xs px-3 py-2">Review</button><button class="btn-accent text-xs px-3 py-2">Reinstate</button></div></td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Content & Moderation -->
                <section id="content" class="card">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-primary">Announcements & Moderation</h2>
                        <button class="btn-secondary text-sm">New Announcement</button>
                    </div>
                    <div class="grid md:grid-cols-2 gap-6">
                        <div class="p-4 border border-primary-200 rounded-lg">
                            <h3 class="font-semibold text-primary mb-2">Latest Announcement</h3>
                            <p class="text-sm text-text-secondary mb-3">We are rolling out the new VR Showroom analytics next week. Expect minor maintenance.</p>
                            <div class="flex gap-2">
                                <button class="btn-secondary text-sm">Publish</button>
                                <button class="btn-accent text-sm">Schedule</button>
                            </div>
                        </div>
                        <div class="p-4 border border-primary-200 rounded-lg">
                            <h3 class="font-semibold text-primary mb-2">Flagged Reviews</h3>
                            <ul class="space-y-3">
                                <li class="flex items-start justify-between p-3 rounded-lg border border-primary-100">
                                    <div class="pr-4">
                                        <p class="text-sm"><span class="font-semibold">@user584</span> flagged for spam on ISS VR Experience</p>
                                        <p class="text-xs text-text-secondary mt-1">Reason: repetitive content • 2 hours ago</p>
                                    </div>
                                    <div class="flex gap-2">
                                        <button class="btn-secondary text-xs px-3 py-2">Dismiss</button>
                                        <button class="btn-accent text-xs px-3 py-2">Remove</button>
                                    </div>
                                </li>
                                <li class="flex items-start justify-between p-3 rounded-lg border border-primary-100">
                                    <div class="pr-4">
                                        <p class="text-sm"><span class="font-semibold">@vrFan</span> language concern on Meta Quest 3 review</p>
                                        <p class="text-xs text-text-secondary mt-1">Reason: offensive language • 1 day ago</p>
                                    </div>
                                    <div class="flex gap-2">
                                        <button class="btn-secondary text-xs px-3 py-2">Warn</button>
                                        <button class="btn-accent text-xs px-3 py-2">Remove</button>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                </section>

                <!-- Settings -->
                <section id="settings" class="card">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-primary">Settings</h2>
                        <button class="btn-accent text-sm">Save Changes</button>
                    </div>
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <h3 class="font-semibold text-primary mb-4">Store</h3>
                            <div class="space-y-4">
                                <label class="block">
                                    <span class="text-sm text-text-secondary">Store Name</span>
                                    <input type="text" class="input-field mt-1" placeholder="Illusionix" />
                                </label>
                                <label class="block">
                                    <span class="text-sm text-text-secondary">Support Email</span>
                                    <input type="email" class="input-field mt-1" placeholder="support@illusionix.io" />
                                </label>
                                <label class="block">
                                    <span class="text-sm text-text-secondary">Currency</span>
                                    <select class="input-field mt-1">
                                        <option>USD</option>
                                        <option>EUR</option>
                                        <option>GBP</option>
                                    </select>
                                </label>
                            </div>
                        </div>
                        <div>
                            <h3 class="font-semibold text-primary mb-4">Security</h3>
                            <div class="space-y-4">
                                <div class="flex items-center justify-between p-3 border border-primary-200 rounded-lg">
                                    <div>
                                        <p class="font-medium">Two-Factor Authentication</p>
                                        <p class="text-sm text-text-secondary">Require 2FA for all admins</p>
                                    </div>
                                    <button class="btn-secondary text-sm">Enable</button>
                                </div>
                                <div class="flex items-center justify-between p-3 border border-primary-200 rounded-lg">
                                    <div>
                                        <p class="font-medium">Audit Logs</p>
                                        <p class="text-sm text-text-secondary">Track critical changes and access</p>
                                    </div>
                                    <button class="btn-secondary text-sm">View</button>
                                </div>
                                <div class="flex items-center justify-between p-3 border border-primary-200 rounded-lg">
                                    <div>
                                        <p class="font-medium">Maintenance Mode</p>
                                        <p class="text-sm text-text-secondary">Temporarily disable storefront</p>
                                    </div>
                                    <button class="btn-secondary text-sm">Activate</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </main>
        </div>
    </div>
</section>

<!-- Footer -->
<footer class="bg-primary-900 text-white py-16">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-8 mb-12">
            <!-- Company Info -->
            <div>
                <div class="flex items-center mb-6">
                    <svg class="w-8 h-8 text-accent" viewBox="0 0 40 40" fill="currentColor">
                        <path d="M20 4L36 12v16L20 36L4 28V12L20 4z"/>
                        <circle cx="20" cy="20" r="8" fill="white"/>
                        <circle cx="20" cy="20" r="4" fill="currentColor"/>
                    </svg>
                    <span class="ml-3 text-xl font-bold">Illusionix</span>
                </div>
                <p class="text-primary-300 mb-6">
                    The future of shopping, today. Experience products before you buy with cutting-edge AR/VR technology.
                </p>
                <div class="flex space-x-4">
                    <a href="javascript:void(0)" class="text-primary-400 hover:text-accent transition-colors">
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179 0-5.515 2.966-4.797 6.045-4.091-.205-7.719-2.165-10.148-5.144-1.29 2.213-.669 5.108 1.523 6.574-.806-.026-1.566-.247-2.229-.616-.054 2.281 1.581 4.415 3.949 4.89-.693.188-1.452.232-2.224.084.626 1.956 2.444 3.379 4.6 3.419-2.07 1.623-4.678 2.348-7.29 2.04 2.179 1.397 4.768 2.212 7.548 2.212 9.142 0 14.307-7.721 13.995-14.646.962-.695 1.797-1.562 2.457-2.549z"/>
                        </svg>
                    </a>
                    <a href="javascript:void(0)" class="text-primary-400 hover:text-accent transition-colors">
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M22.46 6c-.77.35-1.6.58-2.46.69.88-.53 1.56-1.37 1.88-2.38-.83.5-1.75.85-2.72 1.05C18.37 4.5 17.26 4 16 4c-2.35 0-4.27 1.92-4.27 4.29 0 .34.04.67.11.98C8.28 9.09 5.11 7.38 3 4.79c-.37.63-.58 1.37-.58 2.15 0 1.49.75 2.81 1.91 3.56-.71 0-1.37-.2-1.95-.5v.03c0 2.08 1.48 3.82 3.44 4.21a4.22 4.22 0 0 1-1.93.07 4.28 4.28 0 0 0 4 2.98 8.521 8.521 0 0 1-5.33 1.84c-.34 0-.68-.02-1.02-.06C3.44 20.29 5.7 21 8.12 21 16 21 20.33 14.46 20.33 8.79c0-.19 0-.37-.01-.56.84-.6 1.56-1.36 2.14-2.23z"/>
                        </svg>
                    </a>
                    <a href="javascript:void(0)" class="text-primary-400 hover:text-accent transition-colors">
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                        </svg>
                    </a>
                </div>
            </div>

            <!-- Products -->
            <div>
                <h3 class="text-lg font-semibold mb-6">Products</h3>
                <ul class="space-y-3">
                    <li><a href="product_categories" class="text-primary-300 hover:text-accent transition-colors">VR Headsets</a></li>
                    <li><a href="product_categories" class="text-primary-300 hover:text-accent transition-colors">AR Glasses</a></li>
                    <li><a href="product_categories" class="text-primary-300 hover:text-accent transition-colors">Accessories</a></li>
                    <li><a href="product_categories" class="text-primary-300 hover:text-accent transition-colors">Enterprise Solutions</a></li>
                </ul>
            </div>

            <!-- Support -->
            <div>
                <h3 class="text-lg font-semibold mb-6">Support</h3>
                <ul class="space-y-3">
                    <li><a href="javascript:void(0)" class="text-primary-300 hover:text-accent transition-colors">Setup Guides</a></li>
                    <li><a href="javascript:void(0)" class="text-primary-300 hover:text-accent transition-colors">Troubleshooting</a></li>
                    <li><a href="javascript:void(0)" class="text-primary-300 hover:text-accent transition-colors">Warranty</a></li>
                    <li><a href="contactl" class="text-primary-300 hover:text-accent transition-colors">Contact Us</a></li>
                </ul>
            </div>

            <!-- Company -->
            <div>
                <h3 class="text-lg font-semibold mb-6">Company</h3>
                <ul class="space-y-3">
                    <li><a href="aboutus" class="text-primary-300 hover:text-accent transition-colors">About Us</a></li>
                    <li><a href="javascript:void(0)" class="text-primary-300 hover:text-accent transition-colors">Careers</a></li>
                    <li><a href="javascript:void(0)" class="text-primary-300 hover:text-accent transition-colors">Press</a></li>
                    <li><a href="javascript:void(0)" class="text-primary-300 hover:text-accent transition-colors">Partners</a></li>
                </ul>
            </div>
        </div>

        <div class="border-t border-primary-700 pt-8 flex flex-col md:flex-row justify-between items-center">
            <p class="text-primary-400 text-sm">
                © 2025 Illusionix. All Rights Reserved.
            </p>
            <div class="flex space-x-6 mt-4 md:mt-0">
                <a href="javascript:void(0)" class="text-primary-400 hover:text-accent text-sm transition-colors">Privacy Policy</a>
                <a href="javascript:void(0)" class="text-primary-400 hover:text-accent text-sm transition-colors">Terms of Service</a>
                <a href="javascript:void(0)" class="text-primary-400 hover:text-accent text-sm transition-colors">Cookie Policy</a>
            </div>
        </div>
    </div>
</footer>

<script>
    // Search functionality
    document.addEventListener('DOMContentLoaded', function() {
        const searchToggle = document.getElementById('search-toggle');
        const searchExpanded = document.getElementById('search-expanded');
        const searchInput = document.getElementById('search-input');

        if (searchToggle && searchExpanded) {
            searchToggle.addEventListener('click', function() {
                const isExpanded = searchExpanded.classList.contains('scale-100');
                if (isExpanded) {
                    searchExpanded.classList.remove('scale-100');
                    searchExpanded.classList.add('scale-0');
                } else {
                    searchExpanded.classList.remove('scale-0');
                    searchExpanded.classList.add('scale-100');
                    searchInput.focus();
                }
            });

            // Close search when clicking outside
            document.addEventListener('click', function(event) {
                if (!searchToggle.contains(event.target) && !searchExpanded.contains(event.target)) {
                    searchExpanded.classList.remove('scale-100');
                    searchExpanded.classList.add('scale-0');
                }
            });
        }
    });
</script>
<script>
    // Admin: Add Product modal + storage + rendering
    document.addEventListener('DOMContentLoaded', () => {
        // JS disabled: server-side Java handles product persistence and rendering
        return;
        const modal = document.getElementById('add-product-modal');
        const openBtn = document.getElementById('new-product-btn');
        const closeBtn = document.getElementById('close-add-product');
        const cancelBtn = document.getElementById('cancel-add-product');
        const form = document.getElementById('add-product-form');
        const imagesInput = document.getElementById('ap-images');
        const previewWrap = document.getElementById('ap-image-previews');
        const productsTableBody = document.querySelector('#products table tbody');

        if (!modal || !openBtn || !closeBtn || !cancelBtn || !form || !imagesInput || !previewWrap || !productsTableBody) return;

        const storageKey = 'adminProducts';
        let selectedBase64Images = [];

        function openModal() {
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }
        function closeModal() {
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        }
        function resetForm() {
            form.reset();
            previewWrap.innerHTML = '';
            selectedBase64Images = [];
        }

        function loadProducts() {
            try {
                const raw = localStorage.getItem(storageKey);
                if (!raw) return [];
                const parsed = JSON.parse(raw);
                return Array.isArray(parsed) ? parsed : [];
            } catch {
                return [];
            }
        }
        function saveProducts(list) {
            localStorage.setItem(storageKey, JSON.stringify(list));
        }

        function pill(status) {
            const map = {
                'Active': 'bg-success-100 text-success',
                'Low Stock': 'bg-warning-50 text-warning',
                'Draft': 'bg-primary-100 text-primary',
            };
            return `<span class="px-2 py-1 rounded-full text-xs ${map[status] || 'bg-primary-100 text-primary'}">${status}</span>`;
        }

        function fmtPrice(n) {
            const num = Number(n || 0);
            return `$${num.toFixed(2)}`;
        }

        function renderAddedProducts() {
            // Remove previously rendered dynamic rows
            productsTableBody.querySelectorAll('tr[data-added]')?.forEach(tr => tr.remove());
            const items = loadProducts();
            items.forEach(p => {
                const tr = document.createElement('tr');
                tr.className = 'border-b border-primary-100';
                tr.setAttribute('data-added', '1');
                const thumb = (p.images && p.images[0]) ? `<img src="${p.images[0]}" alt="thumb" class="w-8 h-8 rounded object-cover">` : '';
                tr.innerHTML = `
                    <td class="py-4 pr-4 font-semibold">${p.sku || ''}</td>
                    <td class="py-4 pr-4">
                        <div class="flex items-center gap-2">${thumb}<span>${p.name || ''}</span></div>
                    </td>
                    <td class="py-4 pr-4">${fmtPrice(p.price)}</td>
                    <td class="py-4 pr-4">${p.inventory ?? ''}</td>
                    <td class="py-4 pr-4">${pill(p.status || 'Active')}</td>
                    <td class="py-4">
                        <div class="flex gap-2">
                            <button class="btn-secondary text-xs px-3 py-2" data-action="view">View</button>
                        </div>
                    </td>`;
                // Attach simple view dialog for description + gallery
                tr.querySelector('[data-action="view"]').addEventListener('click', () => showViewDialog(p));
                productsTableBody.appendChild(tr);
            });
        }

        function showViewDialog(p) {
            // lightweight viewer overlay
            const overlay = document.createElement('div');
            overlay.className = 'fixed inset-0 bg-black/50 flex items-center justify-center z-50';
            overlay.innerHTML = `
                <div class="bg-white rounded-xl shadow-xl w-full max-w-2xl mx-4">
                    <div class="flex items-center justify-between px-6 py-4 border-b border-primary-200">
                        <h3 class="text-xl font-semibold text-primary">${p.name || 'Product'}</h3>
                        <button class="text-text-secondary hover:text-error" aria-label="Close">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
                        </button>
                    </div>
                    <div class="px-6 py-5 space-y-4">
                        <div class="text-sm text-text-secondary"><span class="font-semibold text-primary">SKU:</span> ${p.sku || '-'}</div>
                        <div class="text-sm text-text-secondary"><span class="font-semibold text-primary">Price:</span> ${fmtPrice(p.price)}</div>
                        <div class="text-sm text-text-secondary"><span class="font-semibold text-primary">Inventory:</span> ${p.inventory ?? '-'}</div>
                        <div>
                            <h4 class="font-semibold text-primary mb-1">Description</h4>
                            <p class="text-sm text-text-secondary whitespace-pre-line">${(p.description || '').toString()}</p>
                        </div>
                        <div>
                            <h4 class="font-semibold text-primary mb-2">Images</h4>
                            <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2">
                                ${(p.images || []).map(src => `<img src="${src}" class="w-full h-24 object-cover rounded" alt="product image">`).join('') || '<p class="text-sm text-text-secondary">No images</p>'}
                            </div>
                        </div>
                    </div>
                </div>`;
            const close = () => overlay.remove();
            overlay.addEventListener('click', (e) => { if (e.target === overlay) close(); });
            overlay.querySelector('button')?.addEventListener('click', close);
            document.body.appendChild(overlay);
        }

        function previewFiles(files) {
            previewWrap.innerHTML = '';
            selectedBase64Images = [];
            const max = 6;
            const slice = Array.from(files || []).slice(0, max);
            if (slice.length === 0) return;
            let remaining = slice.length;
            slice.forEach(file => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const url = e.target?.result;
                    if (typeof url === 'string') {
                        selectedBase64Images.push(url);
                        const item = document.createElement('div');
                        item.className = 'relative';
                        item.innerHTML = `<img src="${url}" class="w-full h-20 object-cover rounded" alt="preview">`;
                        previewWrap.appendChild(item);
                    }
                    remaining -= 1;
                };
                reader.readAsDataURL(file);
            });
        }

        imagesInput.addEventListener('change', (e) => {
            previewFiles(e.target.files);
        });

        openBtn.addEventListener('click', () => {
            resetForm();
            openModal();
        });
        closeBtn.addEventListener('click', () => { closeModal(); });
        cancelBtn.addEventListener('click', () => { closeModal(); });
        // close modal on backdrop click
        modal.addEventListener('click', (e) => { if (e.target === modal) closeModal(); });

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const sku = (document.getElementById('ap-sku').value || '').trim();
            const name = (document.getElementById('ap-name').value || '').trim();
            const price = parseFloat(document.getElementById('ap-price').value || '0');
            const inventory = parseInt(document.getElementById('ap-inventory').value || '0', 10);
            const status = document.getElementById('ap-status').value || 'Active';
            const description = document.getElementById('ap-description').value || '';

            if (!sku || !name) {
                alert('Please provide both SKU and Name.');
                return;
            }

            // If user submitted without triggering change, convert files now
            if (selectedBase64Images.length === 0 && imagesInput.files?.length) {
                await new Promise((resolve) => {
                    let count = 0;
                    const max = Math.min(imagesInput.files.length, 6);
                    for (let i = 0; i < max; i++) {
                        const fr = new FileReader();
                        fr.onload = (evt) => {
                            if (typeof evt.target.result === 'string') {
                                selectedBase64Images.push(evt.target.result);
                            }
                            count++; if (count === max) resolve();
                        };
                        fr.readAsDataURL(imagesInput.files[i]);
                    }
                    if (max === 0) resolve();
                });
            }

            const newItem = { sku, name, price: isNaN(price) ? 0 : price, inventory: isNaN(inventory) ? 0 : inventory, status, description, images: selectedBase64Images.slice(0, 6) };
            const current = loadProducts();
            current.push(newItem);
            saveProducts(current);
            // Best-effort persist to backend (no design change if it fails)
            try {
                fetch('/api/products', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },
                    body: JSON.stringify(newItem)
                }).catch(()=>{});
            } catch(_){ /* ignore */ }
            renderAddedProducts();
            closeModal();
            resetForm();
        });

        // Initial render
        renderAddedProducts();
    });
</script>
<script id="dhws-dataInjector" src="../public/dhws-data-injector.js"></script>
</body>
</html>
